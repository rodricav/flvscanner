<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>FLV Scanner ‚Äî Teste de Valida√ß√£o</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  :root {
    --bg: #0f172a;
    --surface: #1e293b;
    --surface2: #334155;
    --border: #475569;
    --accent: #10b981;
    --accent-dim: #059669;
    --blue: #3b82f6;
    --yellow: #fbbf24;
    --red: #ef4444;
    --text: #f1f5f9;
    --muted: #94a3b8;
    --shadow: 0 4px 6px -1px rgba(0,0,0,0.3);
  }

  body {
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    touch-action: pan-y;
  }

  /* HEADER */
  header {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 16px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 18px;
    font-weight: 700;
  }

  .logo-icon {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, var(--accent), var(--blue));
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
  }

  .badge {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 5px 12px;
    border-radius: 20px;
    background: rgba(16,185,129,0.1);
    border: 1px solid rgba(16,185,129,0.3);
    font-size: 12px;
    color: var(--accent);
    font-weight: 600;
  }

  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.6; transform: scale(0.85); }
  }

  /* CAMERA VIEW */
  .camera-container {
    position: relative;
    width: 100%;
    height: calc(100vh - 68px - 280px);
    min-height: 400px;
    background: #000;
    overflow: hidden;
  }

  #videoElement {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .camera-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
  }

  .scan-frame {
    position: relative;
    width: 80%;
    max-width: 400px;
    aspect-ratio: 1;
    border: 3px dashed rgba(16,185,129,0.5);
    border-radius: 24px;
    background: rgba(16,185,129,0.03);
  }

  .scan-frame.active {
    border-color: var(--accent);
    background: rgba(16,185,129,0.08);
    animation: scanPulse 1.5s ease-in-out infinite;
  }

  @keyframes scanPulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(16,185,129,0.4); }
    50% { box-shadow: 0 0 0 12px rgba(16,185,129,0); }
  }

  .corner-marker {
    position: absolute;
    width: 24px;
    height: 24px;
    border-color: var(--accent);
    border-style: solid;
    border-width: 0;
  }

  .corner-marker.tl { top: -3px; left: -3px; border-top-width: 3px; border-left-width: 3px; border-radius: 4px 0 0 0; }
  .corner-marker.tr { top: -3px; right: -3px; border-top-width: 3px; border-right-width: 3px; border-radius: 0 4px 0 0; }
  .corner-marker.bl { bottom: -3px; left: -3px; border-bottom-width: 3px; border-left-width: 3px; border-radius: 0 0 0 4px; }
  .corner-marker.br { bottom: -3px; right: -3px; border-bottom-width: 3px; border-right-width: 3px; border-radius: 0 0 4px 0; }

  .scan-hint {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: rgba(241,245,249,0.6);
    font-size: 14px;
    line-height: 1.6;
    padding: 0 20px;
  }

  .scan-hint-icon {
    font-size: 48px;
    margin-bottom: 12px;
    opacity: 0.5;
  }

  /* Scan beam */
  .scan-beam {
    position: absolute;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, transparent, var(--accent), var(--accent), transparent);
    box-shadow: 0 0 20px rgba(16,185,129,0.6);
    display: none;
    animation: scanBeam 2s ease-in-out infinite;
  }

  .scan-frame.active .scan-beam {
    display: block;
  }

  @keyframes scanBeam {
    0% { top: 10%; opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { top: 90%; opacity: 0; }
  }

  /* Detection boxes */
  .detection-box {
    position: absolute;
    border: 2px solid var(--accent);
    border-radius: 8px;
    background: rgba(16,185,129,0.1);
    animation: boxAppear 0.3s ease-out;
    pointer-events: none;
  }

  .det-label {
    position: absolute;
    top: -32px;
    left: -2px;
    background: var(--accent);
    color: #000;
    font-size: 11px;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: 6px 6px 6px 0;
    white-space: nowrap;
  }

  .det-price {
    position: absolute;
    bottom: -28px;
    right: -2px;
    background: var(--surface2);
    color: var(--accent);
    font-size: 10px;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: 4px;
  }

  @keyframes boxAppear {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
  }

  /* Camera controls */
  .camera-controls {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 12px;
    pointer-events: all;
  }

  .cam-btn {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: none;
    background: var(--surface2);
    color: var(--text);
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: var(--shadow);
  }

  .cam-btn:active {
    transform: scale(0.95);
  }

  .cam-btn.primary {
    width: 64px;
    height: 64px;
    background: var(--accent);
    font-size: 28px;
  }

  .cam-btn.primary:disabled {
    background: var(--surface2);
    color: var(--muted);
    cursor: not-allowed;
  }

  /* Permission error state */
  .permission-error {
    position: absolute;
    inset: 20px;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    background: rgba(15,23,42,0.95);
    border-radius: 16px;
    padding: 30px;
    z-index: 10;
  }

  .permission-error.show {
    display: flex;
  }

  .error-icon {
    font-size: 56px;
    margin-bottom: 16px;
  }

  .error-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 8px;
  }

  .error-text {
    font-size: 14px;
    color: var(--muted);
    line-height: 1.6;
    margin-bottom: 20px;
    max-width: 320px;
  }

  .error-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .btn-sm {
    padding: 10px 16px;
    border-radius: 8px;
    border: none;
    font-family: 'Inter', sans-serif;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-sm.primary {
    background: var(--accent);
    color: #000;
  }

  .btn-sm.secondary {
    background: var(--surface2);
    color: var(--text);
    border: 1px solid var(--border);
  }

  #fileInput {
    display: none;
  }

  /* Bottom panel */
  .bottom-panel {
    background: var(--surface);
    border-top: 1px solid var(--border);
    padding: 16px 20px;
    max-height: 280px;
    overflow-y: auto;
  }

  .section-title {
    font-size: 12px;
    font-weight: 600;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
  }

  /* Results */
  .results-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .result-item {
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px;
    animation: slideUp 0.3s ease-out;
  }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .result-icon {
    width: 48px;
    height: 48px;
    background: rgba(16,185,129,0.1);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
  }

  .result-info {
    flex: 1;
    min-width: 0;
  }

  .result-name {
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 3px;
  }

  .result-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: var(--muted);
  }

  .conf-badge {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 600;
  }

  .conf-high { background: rgba(16,185,129,0.2); color: var(--accent); }
  .conf-med { background: rgba(251,191,36,0.2); color: var(--yellow); }
  .conf-low { background: rgba(239,68,68,0.2); color: var(--red); }

  .result-price {
    font-size: 18px;
    font-weight: 700;
    color: var(--accent);
  }

  .result-unit {
    font-size: 11px;
    color: var(--muted);
    margin-top: 2px;
  }

  /* Empty state */
  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--muted);
  }

  .empty-icon {
    font-size: 48px;
    opacity: 0.3;
    margin-bottom: 12px;
  }

  .empty-text {
    font-size: 14px;
    line-height: 1.6;
  }

  /* Stats bar */
  .stats-bar {
    display: flex;
    gap: 12px;
    padding: 12px;
    background: var(--surface2);
    border-radius: 10px;
    margin-bottom: 16px;
  }

  .stat {
    flex: 1;
    text-align: center;
  }

  .stat-value {
    font-size: 20px;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 2px;
  }

  .stat-label {
    font-size: 11px;
    color: var(--muted);
    text-transform: uppercase;
  }

  /* Action buttons */
  .action-bar {
    display: flex;
    gap: 10px;
    margin-top: 16px;
  }

  .btn {
    flex: 1;
    padding: 14px;
    border-radius: 10px;
    border: none;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .btn-primary {
    background: var(--accent);
    color: #000;
  }

  .btn-primary:active {
    transform: scale(0.98);
    background: var(--accent-dim);
  }

  .btn-secondary {
    background: var(--surface2);
    color: var(--text);
    border: 1px solid var(--border);
  }

  .btn-secondary:active {
    transform: scale(0.98);
  }

  /* Loading overlay */
  .loading-overlay {
    position: fixed;
    inset: 0;
    background: rgba(15,23,42,0.9);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 200;
    backdrop-filter: blur(4px);
  }

  .loading-overlay.show {
    display: flex;
  }

  .loading-content {
    text-align: center;
  }

  .spinner {
    width: 48px;
    height: 48px;
    border: 4px solid var(--surface2);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 16px;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .loading-text {
    color: var(--accent);
    font-size: 14px;
    font-weight: 600;
  }

  /* Toast */
  .toast {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%) translateY(10px);
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 12px 20px;
    border-radius: 24px;
    font-size: 14px;
    font-weight: 500;
    box-shadow: var(--shadow);
    opacity: 0;
    transition: all 0.3s;
    z-index: 300;
    max-width: 90%;
  }

  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  .toast.success {
    background: rgba(16,185,129,0.2);
    border-color: var(--accent);
    color: var(--accent);
  }

  .toast.error {
    background: rgba(239,68,68,0.2);
    border-color: var(--red);
    color: var(--red);
  }

  /* Help modal */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 400;
    padding: 20px;
  }

  .modal-overlay.show {
    display: flex;
  }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    max-width: 400px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
  }

  .modal-title {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 16px;
    color: var(--accent);
  }

  .modal-text {
    font-size: 14px;
    line-height: 1.6;
    color: var(--muted);
    margin-bottom: 12px;
  }

  .modal-close {
    width: 100%;
    padding: 12px;
    background: var(--accent);
    color: #000;
    border: none;
    border-radius: 8px;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 16px;
  }

  .tip-box {
    background: rgba(16,185,129,0.1);
    border: 1px solid rgba(16,185,129,0.3);
    border-radius: 8px;
    padding: 12px;
    margin: 12px 0;
  }

  .tip-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 6px;
  }

  .tip-list {
    font-size: 13px;
    color: var(--text);
    line-height: 1.6;
    padding-left: 16px;
  }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-icon">ü•¨</div>
    <span>FLV Scanner</span>
  </div>
  <div class="badge">
    <div class="status-dot"></div>
    <span>TESTE</span>
  </div>
</header>

<!-- CAMERA -->
<div class="camera-container">
  <video id="videoElement" autoplay playsinline></video>
  <canvas id="canvas" style="display:none"></canvas>
  <input type="file" id="fileInput" accept="image/*" capture="environment" onchange="handleFileUpload(event)">
  
  <!-- Permission error state -->
  <div class="permission-error" id="permissionError">
    <div class="error-icon">üì∑</div>
    <div class="error-title">C√¢mera n√£o dispon√≠vel</div>
    <div class="error-text">
      N√£o foi poss√≠vel acessar a c√¢mera. Voc√™ pode fazer upload de uma foto ou tentar novamente permitindo o acesso.
    </div>
    <div class="error-actions">
      <button class="btn-sm primary" onclick="document.getElementById('fileInput').click()">
        üì§ Enviar Foto
      </button>
      <button class="btn-sm secondary" onclick="retryCamera()">
        üîÑ Tentar Novamente
      </button>
    </div>
  </div>
  
  <div class="camera-overlay">
    <div class="scan-frame" id="scanFrame">
      <div class="corner-marker tl"></div>
      <div class="corner-marker tr"></div>
      <div class="corner-marker bl"></div>
      <div class="corner-marker br"></div>
      <div class="scan-beam"></div>
      
      <div class="scan-hint" id="scanHint">
        <div class="scan-hint-icon">üì∏</div>
        <div>Posicione frutas, legumes ou<br>verduras dentro do quadro</div>
      </div>
    </div>
  </div>

  <!-- Detection boxes container -->
  <div id="detectionBoxes" style="position:absolute;inset:0;pointer-events:none;"></div>

  <div class="camera-controls">
    <button class="cam-btn" onclick="document.getElementById('fileInput').click()" title="Upload foto">üì§</button>
    <button class="cam-btn primary" onclick="captureAndAnalyze()" id="btnCapture">üì∑</button>
    <button class="cam-btn" onclick="showHelp()">‚ùì</button>
  </div>
</div>

<!-- BOTTOM PANEL -->
<div class="bottom-panel">
  <div class="stats-bar" id="statsBar" style="display:none">
    <div class="stat">
      <div class="stat-value" id="statItems">0</div>
      <div class="stat-label">Itens</div>
    </div>
    <div class="stat">
      <div class="stat-value" id="statTotal">R$ 0,00</div>
      <div class="stat-label">Total</div>
    </div>
    <div class="stat">
      <div class="stat-value" id="statConf">‚Äî</div>
      <div class="stat-label">Confian√ßa</div>
    </div>
  </div>

  <div class="section-title">Produtos Detectados</div>
  
  <div id="resultsList" class="results-list">
    <div class="empty-state">
      <div class="empty-icon">üõí</div>
      <div class="empty-text">
        Nenhum produto detectado<br>
        <small style="color:#64748b">Toque no bot√£o da c√¢mera para escanear</small>
      </div>
    </div>
  </div>

  <div class="action-bar" id="actionBar" style="display:none">
    <button class="btn btn-secondary" onclick="clearResults()">
      <span>üóë</span> Limpar
    </button>
    <button class="btn btn-primary" onclick="simulateCheckout()">
      <span>‚úì</span> Finalizar (R$ <span id="totalBtn">0,00</span>)
    </button>
  </div>
</div>

<!-- LOADING -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-content">
    <div class="spinner"></div>
    <div class="loading-text">Analisando com IA...</div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- HELP MODAL -->
<div class="modal-overlay" id="helpModal">
  <div class="modal">
    <div class="modal-title">üí° Como usar</div>
    
    <div class="modal-text">
      Este √© um teste de valida√ß√£o do sistema SmartCheckout para reconhecimento de frutas, legumes e verduras (FLV) usando a c√¢mera do celular.
    </div>

    <div class="tip-box">
      <div class="tip-title">‚úÖ Para melhores resultados:</div>
      <ul class="tip-list">
        <li>Use luz natural ou ambiente bem iluminado</li>
        <li>Posicione os produtos dentro do quadro verde</li>
        <li>Pode estar em saco pl√°stico transparente</li>
        <li>Se a c√¢mera n√£o funcionar, use o bot√£o üì§ para fazer upload</li>
        <li>Tente diferentes √¢ngulos se n√£o reconhecer</li>
      </ul>
    </div>

    <div class="modal-text">
      <strong>Produtos reconhecidos:</strong><br>
      Tomate, Alface, Banana, Ma√ß√£, Laranja, Cenoura, Batata, Cebola, Lim√£o, Abacate, Morango, Pepino, Piment√£o, Br√≥colis, Couve, Manga, Mam√£o, Uva, Melancia, Ab√≥bora e mais.
    </div>

    <div class="modal-text" style="font-size:12px; color:#64748b; margin-top:16px">
      ‚ÑπÔ∏è <strong>Permiss√£o de c√¢mera:</strong> Se o navegador bloquear o acesso √† c√¢mera, use o bot√£o de upload (üì§) para enviar uma foto da galeria. No Chrome/Safari mobile, voc√™ precisar√° permitir o acesso √† c√¢mera nas configura√ß√µes do navegador.
    </div>

    <div class="modal-text" style="font-size:12px; color:#64748b; margin-top:8px">
      ‚ö†Ô∏è Esta √© uma simula√ß√£o para valida√ß√£o. Os pre√ßos s√£o hipot√©ticos e o reconhecimento usa um modelo simulado baseado em padr√µes visuais comuns.
    </div>

    <button class="modal-close" onclick="closeHelp()">Entendi</button>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FRUIT/VEGETABLE DATABASE WITH PRICES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const FLV_DATABASE = {
  // Frutas
  'apple': { name: 'Ma√ß√£', icon: 'üçé', price: 6.99, unit: '/kg', category: 'Frutas', keywords: ['apple', 'ma√ß√£', 'red', 'fruit', 'vermelho'] },
  'banana': { name: 'Banana', icon: 'üçå', price: 4.50, unit: '/kg', category: 'Frutas', keywords: ['banana', 'yellow', 'amarelo', 'fruit'] },
  'orange': { name: 'Laranja', icon: 'üçä', price: 3.99, unit: '/kg', category: 'Frutas', keywords: ['orange', 'laranja', 'citrus', 'fruit'] },
  'lemon': { name: 'Lim√£o', icon: 'üçã', price: 5.49, unit: '/kg', category: 'Frutas', keywords: ['lemon', 'lim√£o', 'lime', 'citrus', 'yellow'] },
  'strawberry': { name: 'Morango', icon: 'üçì', price: 12.99, unit: '/bandeja', category: 'Frutas', keywords: ['strawberry', 'morango', 'red', 'berry'] },
  'watermelon': { name: 'Melancia', icon: 'üçâ', price: 2.99, unit: '/kg', category: 'Frutas', keywords: ['watermelon', 'melancia', 'green', 'red'] },
  'grape': { name: 'Uva', icon: 'üçá', price: 8.99, unit: '/kg', category: 'Frutas', keywords: ['grape', 'uva', 'purple', 'fruit'] },
  'avocado': { name: 'Abacate', icon: 'ü•ë', price: 7.99, unit: '/kg', category: 'Frutas', keywords: ['avocado', 'abacate', 'green'] },
  'mango': { name: 'Manga', icon: 'ü•≠', price: 5.99, unit: '/kg', category: 'Frutas', keywords: ['mango', 'manga', 'yellow', 'fruit'] },
  'papaya': { name: 'Mam√£o', icon: 'ü´ê', price: 4.99, unit: '/kg', category: 'Frutas', keywords: ['papaya', 'mam√£o', 'orange', 'fruit'] },
  'pineapple': { name: 'Abacaxi', icon: 'üçç', price: 6.99, unit: '/un', category: 'Frutas', keywords: ['pineapple', 'abacaxi', 'yellow'] },
  
  // Verduras
  'lettuce': { name: 'Alface', icon: 'ü•¨', price: 3.49, unit: '/ma√ßo', category: 'Verduras', keywords: ['lettuce', 'alface', 'green', 'leaf', 'salad'] },
  'cabbage': { name: 'Repolho', icon: 'ü•¨', price: 2.99, unit: '/kg', category: 'Verduras', keywords: ['cabbage', 'repolho', 'green', 'purple'] },
  'kale': { name: 'Couve', icon: 'ü•¨', price: 2.49, unit: '/ma√ßo', category: 'Verduras', keywords: ['kale', 'couve', 'green', 'leaf'] },
  'spinach': { name: 'Espinafre', icon: 'ü•¨', price: 3.99, unit: '/ma√ßo', category: 'Verduras', keywords: ['spinach', 'espinafre', 'green', 'leaf'] },
  'broccoli': { name: 'Br√≥colis', icon: 'ü•¶', price: 8.99, unit: '/kg', category: 'Verduras', keywords: ['broccoli', 'br√≥colis', 'green'] },
  
  // Legumes
  'tomato': { name: 'Tomate', icon: 'üçÖ', price: 5.99, unit: '/kg', category: 'Legumes', keywords: ['tomato', 'tomate', 'red', 'vegetable'] },
  'carrot': { name: 'Cenoura', icon: 'ü•ï', price: 3.99, unit: '/kg', category: 'Legumes', keywords: ['carrot', 'cenoura', 'orange', 'root'] },
  'potato': { name: 'Batata', icon: 'ü•î', price: 3.49, unit: '/kg', category: 'Legumes', keywords: ['potato', 'batata', 'brown', 'tuber'] },
  'onion': { name: 'Cebola', icon: 'üßÖ', price: 4.49, unit: '/kg', category: 'Legumes', keywords: ['onion', 'cebola', 'white', 'bulb'] },
  'pepper': { name: 'Piment√£o', icon: 'ü´ë', price: 7.99, unit: '/kg', category: 'Legumes', keywords: ['pepper', 'piment√£o', 'bell pepper', 'green', 'red', 'yellow'] },
  'cucumber': { name: 'Pepino', icon: 'ü•í', price: 4.99, unit: '/kg', category: 'Legumes', keywords: ['cucumber', 'pepino', 'green'] },
  'eggplant': { name: 'Berinjela', icon: 'üçÜ', price: 6.99, unit: '/kg', category: 'Legumes', keywords: ['eggplant', 'berinjela', 'purple'] },
  'pumpkin': { name: 'Ab√≥bora', icon: 'üéÉ', price: 2.99, unit: '/kg', category: 'Legumes', keywords: ['pumpkin', 'ab√≥bora', 'squash', 'orange'] },
  'corn': { name: 'Milho', icon: 'üåΩ', price: 1.99, unit: '/un', category: 'Legumes', keywords: ['corn', 'milho', 'yellow'] },
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

let stream = null;
let facingMode = 'environment'; // 'user' for front camera
let detectedItems = [];
let isProcessing = false;
let cameraAvailable = false;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CAMERA SETUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function initCamera() {
  try {
    const video = document.getElementById('videoElement');
    
    const constraints = {
      video: {
        facingMode: facingMode,
        width: { ideal: 1920 },
        height: { ideal: 1080 }
      }
    };

    stream = await navigator.mediaDevices.getUserMedia(constraints);
    video.srcObject = stream;
    cameraAvailable = true;
    
    document.getElementById('permissionError').classList.remove('show');
    showToast('C√¢mera ativada ‚úì', 'success');
  } catch (err) {
    console.error('Camera error:', err);
    cameraAvailable = false;
    document.getElementById('permissionError').classList.add('show');
    
    let errorMsg = 'Erro ao acessar c√¢mera';
    if (err.name === 'NotAllowedError') {
      errorMsg = 'Permiss√£o de c√¢mera negada. Use o bot√£o "Enviar Foto" para fazer upload.';
    } else if (err.name === 'NotFoundError') {
      errorMsg = 'Nenhuma c√¢mera encontrada. Use o bot√£o "Enviar Foto".';
    } else if (err.name === 'NotReadableError') {
      errorMsg = 'C√¢mera em uso por outro app. Use o bot√£o "Enviar Foto".';
    }
    
    showToast(errorMsg, 'error');
  }
}

async function retryCamera() {
  document.getElementById('permissionError').classList.remove('show');
  await initCamera();
}

async function toggleCamera() {
  if (!cameraAvailable) {
    showToast('C√¢mera n√£o dispon√≠vel. Use upload de foto.', 'error');
    return;
  }
  
  if (stream) {
    stream.getTracks().forEach(track => track.stop());
  }
  facingMode = facingMode === 'environment' ? 'user' : 'environment';
  await initCamera();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FILE UPLOAD HANDLER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function handleFileUpload(event) {
  const file = event.target.files[0];
  if (!file) return;

  if (!file.type.startsWith('image/')) {
    showToast('Por favor, selecione uma imagem', 'error');
    return;
  }

  isProcessing = true;
  document.getElementById('loadingOverlay').classList.add('show');
  document.getElementById('scanFrame').classList.add('active');
  document.getElementById('scanHint').style.display = 'none';

  try {
    // Load image into canvas
    const img = await loadImage(file);
    const canvas = document.getElementById('canvas');
    canvas.width = img.width;
    canvas.height = img.height;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0);

    // Simulate processing delay
    await sleep(800);

    // Get image data for analysis
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    
    // Simulate Google Vision AI analysis
    const results = await simulateVisionAnalysis(imageData);

    // Show detection boxes
    results.forEach((item, i) => {
      setTimeout(() => {
        showDetectionBox(item, i);
      }, i * 200);
    });

    await sleep(results.length * 200 + 300);

    // Add to results
    results.forEach(item => {
      if (!detectedItems.find(d => d.id === item.id)) {
        detectedItems.push(item);
      }
    });

    renderResults();
    clearDetectionBoxes();
    
    if (results.length > 0) {
      showToast(`‚úÖ ${results.length} produto(s) detectado(s)!`, 'success');
    } else {
      showToast('Nenhum FLV detectado. Tente outra foto.', 'error');
    }

  } catch (err) {
    console.error('Upload error:', err);
    showToast('Erro ao carregar imagem. Tente outra foto.', 'error');
  } finally {
    isProcessing = false;
    document.getElementById('loadingOverlay').classList.remove('show');
    document.getElementById('scanFrame').classList.remove('active');
    document.getElementById('scanHint').style.display = '';
    event.target.value = ''; // Reset file input
  }
}

function loadImage(file) {
  return new Promise((resolve, reject) => {
    const img = new Image();
    const url = URL.createObjectURL(file);
    
    img.onload = () => {
      URL.revokeObjectURL(url);
      resolve(img);
    };
    
    img.onerror = () => {
      URL.revokeObjectURL(url);
      reject(new Error('N√£o foi poss√≠vel carregar a imagem'));
    };
    
    img.src = url;
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CAPTURE & ANALYZE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function captureAndAnalyze() {
  if (isProcessing) return;
  
  // Init camera on first capture attempt
  if (!cameraAvailable && !stream) {
    await initCamera();
    if (!cameraAvailable) {
      // Camera still not available, suggest upload
      return;
    }
  }
  
  if (!cameraAvailable) {
    showToast('Use o bot√£o "üì§" para enviar uma foto', 'error');
    document.getElementById('fileInput').click();
    return;
  }
  
  isProcessing = true;
  document.getElementById('btnCapture').disabled = true;
  document.getElementById('loadingOverlay').classList.add('show');
  document.getElementById('scanFrame').classList.add('active');
  document.getElementById('scanHint').style.display = 'none';

  try {
    // Capture frame
    const video = document.getElementById('videoElement');
    
    // Check if video has valid dimensions
    if (!video.videoWidth || !video.videoHeight) {
      throw new Error('V√≠deo n√£o inicializado. Aguarde...');
    }
    
    const canvas = document.getElementById('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0);

    // Simulate processing delay
    await sleep(800);

    // Get image data for analysis
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    
    // Simulate Google Vision AI analysis
    const results = await simulateVisionAnalysis(imageData);

    // Show detection boxes
    results.forEach((item, i) => {
      setTimeout(() => {
        showDetectionBox(item, i);
      }, i * 200);
    });

    await sleep(results.length * 200 + 300);

    // Add to results
    results.forEach(item => {
      if (!detectedItems.find(d => d.id === item.id)) {
        detectedItems.push(item);
      }
    });

    renderResults();
    clearDetectionBoxes();
    
    if (results.length > 0) {
      showToast(`‚úÖ ${results.length} produto(s) detectado(s)!`, 'success');
    } else {
      showToast('Nenhum FLV detectado. Tente novamente.', 'error');
    }

  } catch (err) {
    console.error('Analysis error:', err);
    showToast('Erro: ' + err.message, 'error');
  } finally {
    isProcessing = false;
    document.getElementById('btnCapture').disabled = false;
    document.getElementById('loadingOverlay').classList.remove('show');
    document.getElementById('scanFrame').classList.remove('active');
    document.getElementById('scanHint').style.display = '';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SIMULATED VISION AI ANALYSIS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function simulateVisionAnalysis(imageData) {
  // Simulate Google Vision AI label detection
  // In production, this would call the actual Vision API
  
  // Analyze color distribution to guess the produce
  const colors = analyzeColors(imageData);
  const detected = [];

  // Simple color-based detection logic
  if (colors.red > 0.3) {
    const items = ['tomato', 'apple', 'strawberry', 'pepper'];
    detected.push(items[Math.floor(Math.random() * items.length)]);
  }
  
  if (colors.green > 0.3) {
    const items = ['lettuce', 'cucumber', 'broccoli', 'kale', 'pepper', 'avocado'];
    detected.push(items[Math.floor(Math.random() * items.length)]);
  }
  
  if (colors.yellow > 0.2) {
    const items = ['banana', 'lemon', 'corn', 'pepper', 'pineapple'];
    detected.push(items[Math.floor(Math.random() * items.length)]);
  }
  
  if (colors.orange > 0.2) {
    const items = ['orange', 'carrot', 'pumpkin', 'papaya', 'mango'];
    detected.push(items[Math.floor(Math.random() * items.length)]);
  }

  // Fallback: random common items
  if (detected.length === 0) {
    const common = ['tomato', 'banana', 'apple', 'lettuce', 'potato'];
    detected.push(common[Math.floor(Math.random() * common.length)]);
  }

  // Remove duplicates and map to database
  const unique = [...new Set(detected)];
  return unique.slice(0, Math.min(3, unique.length)).map((key, i) => {
    const product = FLV_DATABASE[key];
    if (!product) return null;
    
    return {
      id: Date.now() + i,
      key: key,
      name: product.name,
      icon: product.icon,
      price: product.price,
      unit: product.unit,
      category: product.category,
      confidence: 0.85 + Math.random() * 0.14, // 85-99%
      quantity: 1,
      bbox: generateRandomBBox(),
    };
  }).filter(Boolean);
}

function analyzeColors(imageData) {
  const data = imageData.data;
  const sample = 10000; // Sample every 10000th pixel for performance
  let red = 0, green = 0, yellow = 0, orange = 0, count = 0;

  for (let i = 0; i < data.length; i += sample * 4) {
    const r = data[i];
    const g = data[i + 1];
    const b = data[i + 2];

    // Color detection with tolerance for translucent bags
    if (r > 120 && g < 100 && b < 100) red++;
    if (g > 120 && r < 100 && b < 100) green++;
    if (r > 180 && g > 180 && b < 100) yellow++;
    if (r > 200 && g > 120 && g < 200 && b < 100) orange++;
    count++;
  }

  return {
    red: red / count,
    green: green / count,
    yellow: yellow / count,
    orange: orange / count,
  };
}

function generateRandomBBox() {
  const x = 0.2 + Math.random() * 0.4;
  const y = 0.2 + Math.random() * 0.4;
  const w = 0.15 + Math.random() * 0.2;
  const h = 0.15 + Math.random() * 0.2;
  return { x, y, w, h };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DETECTION BOX VISUALIZATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function showDetectionBox(item, index) {
  const container = document.getElementById('detectionBoxes');
  const videoRect = document.getElementById('videoElement').getBoundingClientRect();
  
  const bbox = item.bbox;
  const x = bbox.x * videoRect.width;
  const y = bbox.y * videoRect.height;
  const w = bbox.w * videoRect.width;
  const h = bbox.h * videoRect.height;

  const box = document.createElement('div');
  box.className = 'detection-box';
  box.style.left = x + 'px';
  box.style.top = y + 'px';
  box.style.width = w + 'px';
  box.style.height = h + 'px';
  
  box.innerHTML = `
    <div class="det-label">${item.icon} ${item.name}</div>
    <div class="det-price">R$ ${item.price.toFixed(2).replace('.', ',')}</div>
  `;
  
  container.appendChild(box);
}

function clearDetectionBoxes() {
  document.getElementById('detectionBoxes').innerHTML = '';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RESULTS RENDERING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function renderResults() {
  const list = document.getElementById('resultsList');
  const statsBar = document.getElementById('statsBar');
  const actionBar = document.getElementById('actionBar');

  if (detectedItems.length === 0) {
    list.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">üõí</div>
        <div class="empty-text">
          Nenhum produto detectado<br>
          <small style="color:#64748b">Toque no bot√£o da c√¢mera para escanear</small>
        </div>
      </div>
    `;
    statsBar.style.display = 'none';
    actionBar.style.display = 'none';
    return;
  }

  statsBar.style.display = 'flex';
  actionBar.style.display = 'flex';

  // Calculate stats
  const total = detectedItems.reduce((sum, item) => sum + item.price * item.quantity, 0);
  const avgConf = detectedItems.reduce((sum, item) => sum + item.confidence, 0) / detectedItems.length;

  document.getElementById('statItems').textContent = detectedItems.length;
  document.getElementById('statTotal').textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
  document.getElementById('statConf').textContent = `${Math.round(avgConf * 100)}%`;
  document.getElementById('totalBtn').textContent = total.toFixed(2).replace('.', ',');

  // Render items
  list.innerHTML = detectedItems.map(item => {
    const confClass = item.confidence >= 0.90 ? 'high' : item.confidence >= 0.75 ? 'med' : 'low';
    const confText = confClass === 'high' ? 'ALTA' : confClass === 'med' ? 'M√âDIA' : 'BAIXA';
    
    return `
      <div class="result-item">
        <div class="result-icon">${item.icon}</div>
        <div class="result-info">
          <div class="result-name">${item.name}</div>
          <div class="result-meta">
            <span class="conf-badge conf-${confClass}">${confText}</span>
            <span>${item.category}</span>
            <span>‚Ä¢</span>
            <span>Qtd: ${item.quantity}</span>
          </div>
        </div>
        <div>
          <div class="result-price">R$ ${(item.price * item.quantity).toFixed(2).replace('.', ',')}</div>
          <div class="result-unit">${item.unit}</div>
        </div>
      </div>
    `;
  }).join('');
}

function clearResults() {
  detectedItems = [];
  renderResults();
  showToast('Resultados limpos', 'success');
}

function simulateCheckout() {
  const total = detectedItems.reduce((sum, item) => sum + item.price * item.quantity, 0);
  showToast(`‚úÖ Checkout simulado: R$ ${total.toFixed(2).replace('.', ',')}`, 'success');
  
  setTimeout(() => {
    clearResults();
  }, 2000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELP MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function showHelp() {
  document.getElementById('helpModal').classList.add('show');
}

function closeHelp() {
  document.getElementById('helpModal').classList.remove('show');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function showToast(message, type = '') {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.className = 'toast show ' + type;
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

window.addEventListener('load', () => {
  // Don't auto-init camera to avoid permission errors
  // User will click capture button or upload button instead
  
  // Show welcome message
  showToast('üëã Use üì§ para enviar foto ou üì∑ para usar c√¢mera', 'success');
  
  // Show help on first load
  if (!localStorage.getItem('flv_help_shown')) {
    setTimeout(showHelp, 2000);
    localStorage.setItem('flv_help_shown', 'true');
  }
});

// Handle modal close on overlay click
document.getElementById('helpModal').addEventListener('click', (e) => {
  if (e.target.id === 'helpModal') closeHelp();
});
</script>

</body>
</html>
